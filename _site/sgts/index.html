<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>PowerNSX</title>
  <meta name="description" content="A Powershell module for NSX for vSphere">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://vmware.github.io/powernsx/sgts/">
  <link rel="alternate" type="application/rss+xml" title="PowerNSX" href="https://vmware.github.io/powernsx/feed.xml">
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">PowerNSX</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <h1 id="security-groups-security-tags-and-services">Security Groups, Security Tags, and Services</h1>

<p>Security Groups and Security Tags provide a powerful asset to the Distributed Firewall.</p>

<h1 id="creating-security-tags-and-listing-groups">Creating Security Tags and listing Groups</h1>

<p>It is easy and quick to create a Security Tag.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; New-NsxSecurityTag PowerNSX-Tag


objectId           : securitytag-329
objectTypeName     : SecurityTag
vsmUuid            : 42011E64-766E-616B-0401-5C68CF27B466
nodeId             : 0509160a-0cfb-4cc2-811a-3193e8b45b95
revision           : 0
type               : type
name               : PowerNSX-Tag
clientHandle       :
extendedAttributes :
isUniversal        : false
universalRevision  : 0
systemResource     : false
vmCount            : 0

</code></pre>
</div>

<p>How about listing all created Security Groups, selecting the desired properties to list and formatting it to a nice table.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; Get-NsxSecurityGroup | select name, objectid | ft -auto

name                        objectId
----                        --------
SG-Provider-NTP             securitygroup-493
SG-Consumer-Internal-SSH    securitygroup-503
SG-Consumer-DNS             securitygroup-498
SG-Provider-Internal-RDP    securitygroup-494
SG-NSX-Components           securitygroup-480
SG-Consumer-Internal-RDP    securitygroup-502
SG-SDDC-Management-Internal securitygroup-486
SG-Provider-SMTP            securitygroup-491
SG-SMTP-Servers             securitygroup-484
SG-LogInsight-Cluster       securitygroup-477
PowerNSX-SG                 securitygroup-505
SG-Provider-Internal-Web    securitygroup-496
SG-Provider-Syslog          securitygroup-492
SG-vSphere-Hosts            securitygroup-479
SG-Consumer-Internal-Web    securitygroup-504
SG-DNS-Servers              securitygroup-481
SG-NTP-Servers              securitygroup-483
SG-AD-Servers               securitygroup-482
SG-vCenter-Appliances       securitygroup-478
SG-Consumer-Syslog          securitygroup-500
SG-DHCP-Servers             securitygroup-485
SG-Provider-DNS             securitygroup-490
SG-Consumer-SMTP            securitygroup-499
SG-Provider-Internal-SSH    securitygroup-495
SG-Provider-ActiveDirectory securitygroup-489
SG-Consumer-NTP             securitygroup-501
SG-Linux-Corporate          securitygroup-488
SG-Windows-Corporate        securitygroup-487
SG-Consumer-ActiveDirectory securitygroup-497

</code></pre>
</div>

<table>
  <tbody>
    <tr>
      <td>A nice simple output of the current Security Groups created and the object IDs. Anything property in the Get-NsxSecurityGroup</td>
      <td>Get-member can be used with select.</td>
    </tr>
  </tbody>
</table>

<h1 id="creating-a-new-security-group">Creating a new Security Group</h1>

<p>Creating a new Security Group is simple with PowerNSX. Either blank groups or groups with included or excluded members can be done. The object passed to -IncludeMember or -ExcludeMember can be the vCenter objects references in the UI.</p>

<p>Lets use the tag we just created.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; $Tag = Get-NsxSecurityTag PowerNSX-Tag

PowerCLI C:\&gt; New-NsxSecurityGroup PowerNSX-SG -Description 'SG for PowerNSX-Tag VMs' -IncludeMember $tag


objectId           : securitygroup-505
objectTypeName     : SecurityGroup
vsmUuid            : 42011E64-766E-616B-0401-5C68CF27B466
nodeId             : 0509160a-0cfb-4cc2-811a-3193e8b45b95
revision           : 2
type               : type
name               : PowerNSX-SG
description        : SG for PowerNSX-Tag VMs
scope              : scope
clientHandle       :
extendedAttributes :
isUniversal        : false
universalRevision  : 0
inheritanceAllowed : false
member             : member

</code></pre>
</div>

<p>Now to apply the Security Tag to a given VM. The first is to find the Virtual Machine Web-02.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; Get-VM | ? {$_.name -eq ("Web-01")} | New-NsxSecurityTagAssignment -ApplyTag $tag
PowerCLI C:\&gt; Get-VM | ? {$_.name -eq ("Web-01")} | Get-NsxSecurityTagAssignment

SecurityTag                                                    VirtualMachine
-----------                                                    --------------
securityTag                                                          web-01

</code></pre>
</div>

<h1 id="service-and-service-groups">Service and Service Groups</h1>

<p>Whilst NSX includes lots of services out of the box due to naming or security reasons an administrator may not want to use the existing services.</p>

<p>A quick purge of all services can be done to start fresh.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

Get-NsxService | Remove-NsxService -force -confirm:$false

</code></pre>
</div>
<p><strong>Achtung!</strong></p>

<p>The above command will remove all services and those included in the default permit rule. Be mindful!</p>

<p>Starting fresh an administrator can create the desired services. Creating a service requires very basic information.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; New-NsxService -name 'tcp-666' -protocol tcp -port 666


objectId           : application-1404
objectTypeName     : Application
vsmUuid            : 42011E64-766E-616B-0401-5C68CF27B466
nodeId             : 0509160a-0cfb-4cc2-811a-3193e8b45b95
revision           : 1
type               : type
name               : tcp-666
description        :
scope              : scope
clientHandle       :
extendedAttributes :
isUniversal        : false
universalRevision  : 0
inheritanceAllowed : false
element            : element
</code></pre>
</div>

<p>Lets look at all the services that are created. The below command will search all custom created Services using the RegEx matches “tcp-“. The select field will output just the name property.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; get-nsxservice | ? {$_.name -match ("tcp-")} | select name | ft

name
----
tcp-666
tcp-22
tcp-3389
tcp-636
tcp-1433
tcp-80
tcp-443
tcp-389
tcp-88
tcp-3268
tcp-3269
tcp-25
tcp-465
tcp-53
tcp-514
tcp-1514
tcp-7000
tcp-9042
tcp-9160
tcp-59778
tcp-16520-16580
tcp-9000
tcp-9543

</code></pre>
</div>

<p>Quick ways to pool the environment are welcomed.</p>

<h1 id="service-groups">Service Groups</h1>

<p>Service Groups are a container that holds other Services or Service Groups</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

PowerCLI C:\&gt; New-NsxServiceGroup SVG-PowerNSX


objectId           : applicationgroup-311
objectTypeName     : ApplicationGroup
vsmUuid            : 42011E64-766E-616B-0401-5C68CF27B
nodeId             : 0509160a-0cfb-4cc2-811a-3193e8b45
revision           : 1
type               : type
name               : SVG-PowerNSX
description        :
scope              : scope
clientHandle       :
extendedAttributes :
isUniversal        : false
universalRevision  : 0
inheritanceAllowed : false

</code></pre>
</div>

<p>Now that the Service Group has been made it is time to add some members to it. This example uses two services - tcp-80 and tcp-443.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
$web = get-nsxservice tcp-80
$webs = get-nsxservice tcp-443
Get-NsxServiceGroup SVG-PowerNSX | Add-NsxServiceGroupMember $web,$WebSg

</code></pre>
</div>

<p>But what about Services included inside a Service Group? We have you covered. The first step is to poll the Service Group SVG-Web-Management and then Get-NsxServiceGroupMembers.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>

  PS C:\&gt; Get-NsxServiceGroup SVG-PowerNSX | Get-NsxServiceGroupMembers


  objectId           : application-413
  objectTypeName     : Application
  vsmUuid            : 42019B98-63EC-995F-6CBB-FF738D027F92
  nodeId             : 0dd7c0dd-a194-4df1-a14b-56a1617c2f0f
  revision           : 2
  type               : type
  name               : tcp-80
  scope              : scope
  clientHandle       :
  extendedAttributes :
  isUniversal        : false
  universalRevision  : 0

  objectId           : application-290
  objectTypeName     : Application
  vsmUuid            : 42019B98-63EC-995F-6CBB-FF738D027F92
  nodeId             : 0dd7c0dd-a194-4df1-a14b-56a1617c2f0f
  revision           : 2
  type               : type
  name               : tcp-443
  scope              : scope
  clientHandle       :
  extendedAttributes :
  isUniversal        : false
  universalRevision  : 0

</code></pre>
</div>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">PowerNSX</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>PowerNSX</li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/vmware"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">vmware</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/powernsxv"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">powernsxv</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A Powershell module for NSX for vSphere
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
